@(pager: Pager)(
implicit req: UserRequest[_], lang: Lang)

@import common._
@import helper._

@layouts.base(Users.vmsg("title")) {

  @common._flashing()

  <div class="row" style="margin-top:10px">
    <h2 style="margin-left: 20px">
      <i class="fa fa-user fa-lg fa-fw"></i>
      @Users.vmsg("head")
    </h2>
  </div>

  <div class="row">
    <div class="table-responsive" ng-controller="UsersCtrl">
      <table class="table table-hover table-ellipsis">
        <thead>
          <tr>
            <th class="hidden-xs col-sm-6">
              @MSG("id")
            </th>
            <th class="col-xs-8  col-sm-3">
              @MSG("email")
            </th>
            <th class="col-xs-4  col-sm-3 text-right">
              @MSG("action")
            </th>
          </tr>
        </thead>
        <tbody>
          <tr class="ng-cloak" ng-repeat="usr in UserList.users">
            <td class="hidden-xs">
              <a ng-href="{{jsRoutes.controllers.Users.show(usr.id).url}}">
                <code>{{ usr.id }}</code>
              </a>
            </td>
            <td class="hidden-xs">
              {{ usr.email }}
            </td>
            <td class="visible-xs">
              <a ng-href="{{jsRoutes.controllers.Users.show(usr.id).url}}">
                {{ usr.email }}
              </a>
            </td>
            <td>
              <div class="pull-right">
                <i class="fa fa-unlock-alt fa-lg fa-fw"></i>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      @ng._pager("UserList.links")

    </div>
  </div>
}()(
  libs.webjars("js", "angular-resource"),
  libs.assets("js", "api"),
  jsRoutes,
  controller
)

@jsRoutes = {
  @helper.javascriptRouter("jsRoutes")(
    routes.javascript.Users.show
  )
}

@controller = {
  <script>
    var list = angular.module('users.list',
      ['ui.bootstrap', 'api.user', 'api.helper']);

    list.factory('UserList',
      ['User', 'LinkHeader', 'Alerts',
      function(User, LinkHeader, Alerts){
        var service = {};
        service.links = LinkHeader.links;

        service.users = User.query({
          page     :@pager.pageNum,
          per_page :@pager.pageSize
          }, function(value, headers){
            LinkHeader.updateLinks(
              '@Html(routes.Users.index(pager.next).toString)',
              '@Html(routes.Users.index(pager.prev).toString)',
              headers);
          });

        service.create = function(data) {
          new User(data).$save(function(value){
            service.users.unshift(value);
          });
        };

        return service;
    }])

    .factory('Alerts', [
      function() {
        return [];
    }])

    .controller('UsersCtrl',
      ['$scope', 'UserList',
      function ($scope, UserList) {
        $scope.UserList = UserList;
        $scope.jsRoutes = jsRoutes;
    }]);

    angular.module('app').requires.push('users.list');
  </script>
}