@(pager: Pager)(
implicit req: UserRequest[_], messages: Messages, secured: RegisteredSecured)

@import common._
@import helper._

@layouts.base(AccessControlsCtrl.msg("title")) {

  @ng._alert()

  @common._flashing()

  <div class="row" style="margin-top:10px">
    <h2 style="margin-left: 20px">
      <i class="fa fa-shield fa-lg fa-fw text-success"></i>
      @AccessControlsCtrl.msg("head")
    </h2>
  </div>

  <div class="row">
    <form name="form" ng-controller="NewEntryCtrl">
      <div class="col-xs-12 col-sm-6 col-md-4">
        @ng._form_control("principal",
          '_inline      -> false,
          'tabindex     -> 1,
          'placeholder  -> AccessControlsCtrl.msg("principal.placeholder"),
          'typeahead    -> "item as item.label for item in getItems($viewValue)",
          'autocomplete -> "off",
          Symbol("ng-model") -> "ac.principal"
        )
      </div>

      <div class="col-xs-12 col-sm-6 col-md-2">
        @ng._select("resource",
          '_inline      -> false,
          'tabindex     -> 2,
          Symbol("ng-model")   -> "ac.resource",
          Symbol("ng-options") -> "k as v for (k,v) in ACList.resources"
        )
      </div>

      <div class="col-xs-12 col-sm-6 col-md-2">
        @ng._select("action",
          '_inline      -> false,
          'tabindex     -> 3,
          Symbol("ng-model")   -> "ac.action",
          Symbol("ng-options") -> "k as v for (k,v) in ACList.actions"
        )
      </div>

      <div class="col-xs-12 col-sm-5 col-md-3">
        @ng._form_group_static("granted",
          '_inline      -> false
        ){
          <div class="btn-group">
            <label class="btn btn-default" ng-model="ac.granted" btn-radio="true">
              <i class="fa fa-check-circle fa-lg text-success"></i>
              @MSG("allow")
            </label>
            <label class="btn btn-default" ng-model="ac.granted" btn-radio="false">
              <i class="fa fa-ban fa-lg text-danger"></i>
              @MSG("deny")
            </label>
          </div>
        }
      </div>

      <div class="col-xs-12 col-sm-1 col-md-1 btn-wrapper">
        <button type="submit" class="btn btn-success pull-right" ng-click="create(ac)">
          <i class="fa fa-save fa-lg"></i>
          @MSG("create")
        </button>
      </div>

    </form>

  </div>

  <div ng-controller="ACCtrl">

    @ng._msg_confirm_delete()

    <div class="row">
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th class="col-xs-4  col-sm-4 ">
                @MSG("principal")
              </th>
              <th class="col-xs-2  col-sm-4 ">
                @MSG("resource")
              </th>
              <th class="col-xs-1  col-sm-2 ">
                @MSG("action")
              </th>
              <th class="col-xs-2  col-sm-2 text-right">
              </th>
            </tr>
          </thead>
          <tbody>
            <tr class="ng-cloak" ng-repeat="ac in ACList.acs" ng-class="ac.resource.indexOf('access_controls') > -1? 'bg-danger' : ''">
              <td ng-if="ac.is_group">
                <a ng-href="{{jsRoutes.controllers.GroupsCtrl.show(ac.principal).url}}">
                  <i class="fa fa-group fa-lg fa-fw text-info"></i>
                  {{ ACList.groups[ac.principal].name }}
                </a>
              </td>
              <td ng-if="!ac.is_group">
                <a ng-href="{{jsRoutes.controllers.UsersCtrl.show(ac.principal).url}}">
                  <i class="fa fa-user fa-lg fa-fw text-info"></i>
                  {{ ACList.users[ac.principal].email }}
                </a>
              </td>
              <td>
                {{ ACList.resources[ac.resource] || ac.resource }}
              </td>
              <td>
                {{ ACList.actions[ac.action] }}
              </td>
              <td>
                <div class="btn-toolbar pull-right">
                  <div class="btn-group">
                    <toggle-switch status="ac.granted" ng-click="ACList.save(ac)"/>
                  </div>
                  <div class="btn-group hidden-xs" style="padding-top:3px">
                    <button type="button" class="btn btn-danger btn-xs" ng-click="confirm(ac)">
                      <i class="fa fa-trash-o"></i>
                      @MSG("delete")
                    </button>
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="row">
      @ng._pager("ACList.links")
    </div>
  </div>
}()(
  libs.webjars("js", "angular-resource"),
  libs.assets("js", "api"),
  libs.assets("js", "ui.parts"),
  libs.assets("js", "access_controls/index"),
  jsRoutes,
  controller
)

@jsRoutes = {
  @helper.javascriptRouter("jsRoutes")(
    routes.javascript.GroupsCtrl.show,
    routes.javascript.UsersCtrl.show
  )
}

@controller = {
  <script>
    views.access_controls.index.run(['ACList', function(ACList) {
      ACList.resources = @Html(secured.Modules.toJson);
      ACList.actions   = @Html(secured.Actions.toJson);
      ACList.reload({
        page     : @pager.pageNum,
        pageSize : @pager.pageSize,
        nextPage : '@Html(routes.AccessControlsCtrl.index(pager.next).toString)',
        prevPage : '@Html(routes.AccessControlsCtrl.index(pager.prev).toString)'
      });
    }]);
  </script>
}